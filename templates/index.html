<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Analyseur IA</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='Css/style.css') }}">
    <script src="{{ url_for('static', filename='JavaScript/script.js') }}" defer></script>
    <style>
        #subtitles { margin-top: 20px; }
        .subtitle { margin: 5px 0; font-size: 1rem; }
        .active { background: yellow; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® Analyseur IA Intelligent</h1>

        <!-- Menu de sÃ©lection -->
        <div class="nav-select">
            <label for="modeSelect"><strong>Choisir le type d'analyse :</strong></label>
            <div class="select-wrapper">
                <select id="modeSelect" name="mode" onchange="toggleFormBlocks()">
                    <option value="video">ğŸ® Analyse VidÃ©o</option>
                    <option value="audio">ğŸ§ Analyse Audio</option>
                    <option value="text">ğŸ“ Analyse Texte</option>
                </select>
                <span class="custom-arrow">â–¼</span>
            </div>
        </div>

        <!-- Formulaire -->
        <form action="/analyze" method="POST" enctype="multipart/form-data" id="formContainer">
            <input type="hidden" id="hiddenMode" name="mode" value="video">

            <!-- VidÃ©o -->
            <div class="form-block" id="videoBlock">
                <h2>ğŸ“¹ VidÃ©o</h2>
                <label for="videoFile" class="upload-label">SÃ©lectionnez une vidÃ©o</label>
                <input type="file" name="videoFile" id="videoFile" accept="video/*">
            </div>

            <!-- Audio -->
            <div class="form-block" id="audioBlock" style="display:none;">
                <h2>ğŸ§ Audio</h2>
                <label for="audioFile" class="upload-label">SÃ©lectionnez un fichier audio</label>
                <input type="file" name="audioFile" id="audioFile" accept="audio/*">
            </div>

            <!-- Texte -->
            <div class="form-block" id="textBlock" style="display:none;">
                <h2>âœï¸ Texte libre</h2>
                <label for="textInput" class="upload-label">Entrez un texte</label>
                <textarea name="textInput" id="textInput" rows="5" placeholder="Ã‰crivez ici votre texteâ€¦"></textarea>
            </div>

            <button type="submit">Soumettre</button>
        </form>

        {% if filename %}
        <div class="preview">
            <h2>ğŸ“ Fichier :</h2>
            {% if filename.endswith('.mp4') %}
            <video id="video" controls width="100%">
                <source src="{{ url_for('static', filename='uploads/' + filename) }}" type="video/mp4">
                Votre navigateur ne prend pas en charge la lecture de vidÃ©os.
            </video>
            <div id="subtitles">
                <h2>ğŸ“„ Transcription :</h2>
            </div>
            {% elif filename.endswith('.mp3') or filename.endswith('.wav') %}
            <audio controls>
                <source src="{{ url_for('static', filename='uploads/' + filename) }}" type="audio/mpeg">
                Votre navigateur ne prend pas en charge la lecture audio.
            </audio>
            <div id="subtitles">
                <h2>ğŸ“„ Transcription :</h2>
            </div>
            {% endif %}
        </div>
        {% endif %}

    

        {% if summary %}
        <div class="summary">
            <h2>ğŸ“ RÃ©sumÃ© gÃ©nÃ©rÃ© :</h2>
            <p>{{ summary }}</p>
        </div>
        {% endif %}
    </div>

    {% if segments %}
    <script>
        const subtitles = {{ segments | safe }};
        const video = document.getElementById("video");
        const container = document.getElementById("subtitles");

        subtitles.forEach((sub, i) => {
            const p = document.createElement("p");
            p.classList.add("subtitle");
            p.setAttribute("data-start", sub.start);
            p.setAttribute("data-end", sub.end);
            p.innerText = sub.text;
            container.appendChild(p);
        });

        video.addEventListener("timeupdate", () => {
            const current = video.currentTime;
            document.querySelectorAll(".subtitle").forEach(el => {
                const start = parseFloat(el.getAttribute("data-start"));
                const end = parseFloat(el.getAttribute("data-end"));
                if (current >= start && current <= end) {
                    el.classList.add("active");
                } else {
                    el.classList.remove("active");
                }
            });
        });
    </script>
    {% endif %}
</body>
</html>
